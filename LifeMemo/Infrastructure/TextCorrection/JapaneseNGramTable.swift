import Foundation

/// Bigram and trigram frequency tables for common business Japanese.
/// Scores are normalized to 0.0–1.0 range (1.0 = most natural pairing).
enum JapaneseNGramTable {

    // MARK: - Bigram lookup

    /// Returns the bigram co-occurrence score for two adjacent words.
    static func bigramScore(first: String, second: String) -> Double {
        bigrams[first]?[second] ?? 0.0
    }

    /// Returns the trigram co-occurrence score for three consecutive words.
    static func trigramScore(first: String, second: String, third: String) -> Double {
        trigrams[first]?[second]?[third] ?? 0.0
    }

    // MARK: - Bigram frequency table

    static let bigrams: [String: [String: Double]] = [
        // 会議 (meeting) context
        "定例": ["会議": 0.95, "報告": 0.70, "作業": 0.40],
        "会議": ["室": 0.85, "資料": 0.80, "議事": 0.75, "出席": 0.65, "開始": 0.60],
        "議事": ["録": 0.90, "進行": 0.70],
        "出席": ["者": 0.90, "確認": 0.60],
        "欠席": ["者": 0.85, "連絡": 0.55],

        // 確認 (confirmation) context
        "確認": ["作業": 0.80, "事項": 0.75, "済み": 0.70, "依頼": 0.65, "結果": 0.60],
        "最終": ["確認": 0.90, "報告": 0.70, "判断": 0.65, "決定": 0.60],
        "内容": ["確認": 0.85, "変更": 0.70, "修正": 0.65],

        // 報告 (report) context
        "報告": ["書": 0.85, "事項": 0.80, "内容": 0.65, "資料": 0.60],
        "進捗": ["報告": 0.90, "状況": 0.80, "確認": 0.70, "管理": 0.60],
        "状況": ["報告": 0.80, "確認": 0.75, "説明": 0.60],

        // 資料 (document) context
        "資料": ["作成": 0.85, "配布": 0.75, "確認": 0.70, "準備": 0.65, "修正": 0.60],
        "配布": ["資料": 0.80, "先": 0.50],
        "参考": ["資料": 0.85, "情報": 0.65],

        // 予算 (budget) context
        "予算": ["管理": 0.85, "計画": 0.80, "申請": 0.75, "超過": 0.60, "削減": 0.55],
        "経費": ["精算": 0.85, "申請": 0.80, "削減": 0.70],
        "売上": ["高": 0.85, "目標": 0.80, "実績": 0.75, "達成": 0.70],

        // 開発 (development) context
        "開発": ["環境": 0.85, "チーム": 0.80, "計画": 0.75, "工程": 0.70, "費用": 0.60],
        "設計": ["書": 0.85, "仕様": 0.80, "変更": 0.70, "レビュー": 0.65],
        "実装": ["方針": 0.80, "完了": 0.75, "作業": 0.70],
        "テスト": ["結果": 0.85, "環境": 0.80, "ケース": 0.75, "計画": 0.70],

        // 営業 (sales) context
        "営業": ["部": 0.85, "活動": 0.80, "報告": 0.75, "目標": 0.70, "利益": 0.65],
        "顧客": ["対応": 0.85, "情報": 0.80, "管理": 0.75, "満足": 0.60],
        "契約": ["書": 0.85, "更新": 0.80, "締結": 0.75, "内容": 0.65],

        // 人事 (HR) context
        "人事": ["部": 0.85, "評価": 0.80, "異動": 0.75, "制度": 0.65],
        "採用": ["面接": 0.85, "活動": 0.80, "計画": 0.75, "基準": 0.60],
        "研修": ["制度": 0.80, "計画": 0.75, "内容": 0.70, "報告": 0.60],

        // 管理 (management) context
        "品質": ["管理": 0.90, "向上": 0.75, "基準": 0.70, "問題": 0.55],
        "工程": ["管理": 0.85, "表": 0.80, "変更": 0.65],
        "在庫": ["管理": 0.85, "確認": 0.75, "数": 0.70],

        // 変更 (change) context
        "変更": ["管理": 0.80, "履歴": 0.75, "依頼": 0.70, "内容": 0.65, "点": 0.60],
        "仕様": ["変更": 0.85, "書": 0.80, "確認": 0.70],

        // 対応 (response) context
        "対応": ["方針": 0.80, "策": 0.75, "状況": 0.70, "完了": 0.65],
        "緊急": ["対応": 0.90, "連絡": 0.75, "会議": 0.60],

        // 日程 (schedule) context
        "日程": ["調整": 0.90, "確認": 0.80, "変更": 0.70],
        "納期": ["確認": 0.85, "遅延": 0.75, "厳守": 0.70, "変更": 0.60],
        "締め切り": ["厳守": 0.80, "延長": 0.70],
        "スケジュール": ["確認": 0.85, "調整": 0.80, "変更": 0.70],

        // 提案 (proposal) context
        "提案": ["書": 0.85, "内容": 0.80, "資料": 0.70],
        "企画": ["書": 0.85, "提案": 0.80, "立案": 0.70],

        // 改善 (improvement) context
        "改善": ["策": 0.85, "提案": 0.80, "活動": 0.75, "点": 0.65],
        "業務": ["改善": 0.85, "効率": 0.80, "フロー": 0.70, "内容": 0.60],

        // 承認 (approval) context
        "承認": ["依頼": 0.85, "済み": 0.80, "フロー": 0.70],
        "決裁": ["書": 0.85, "権限": 0.75],

        // Common verb phrases
        "検討": ["結果": 0.80, "事項": 0.75, "中": 0.65],
        "実施": ["計画": 0.80, "日": 0.75, "状況": 0.65, "結果": 0.60],
        "完了": ["報告": 0.80, "予定": 0.70],
        "共有": ["事項": 0.80, "情報": 0.75],

        // IT/Tech
        "サーバー": ["環境": 0.80, "構築": 0.75, "管理": 0.70],
        "データ": ["ベース": 0.85, "分析": 0.80, "移行": 0.70, "管理": 0.65],
        "セキュリティ": ["対策": 0.85, "監査": 0.75, "強化": 0.70],
        "システム": ["開発": 0.85, "障害": 0.80, "運用": 0.75, "更新": 0.70],

        // Time expressions
        "来週": ["月曜": 0.70, "中": 0.65, "まで": 0.60],
        "今週": ["中": 0.70, "末": 0.65],
        "今月": ["中": 0.70, "末": 0.65],
        "来月": ["初め": 0.65, "中": 0.60],
        "前年": ["比": 0.90, "度": 0.70, "同期": 0.65],
        "前期": ["比": 0.85, "実績": 0.70],
        "四半期": ["決算": 0.80, "報告": 0.75, "目標": 0.65],

        // Numbers / counters
        "第": ["一": 0.70, "二": 0.65, "三": 0.60],
        "約": ["百": 0.50, "千": 0.50, "万": 0.50],
    ]

    // MARK: - Trigram frequency table

    static let trigrams: [String: [String: [String: Double]]] = [
        "定例": [
            "会議": ["議事": 0.85, "資料": 0.75, "開始": 0.65],
        ],
        "会議": [
            "議事": ["録": 0.90],
            "室": ["予約": 0.80],
        ],
        "進捗": [
            "報告": ["書": 0.80, "資料": 0.70],
            "状況": ["確認": 0.80, "報告": 0.75],
        ],
        "売上": [
            "目標": ["達成": 0.85],
            "実績": ["報告": 0.75],
        ],
        "品質": [
            "管理": ["体制": 0.80, "基準": 0.75],
        ],
        "予算": [
            "計画": ["策定": 0.80, "見直し": 0.70],
        ],
        "開発": [
            "環境": ["構築": 0.85, "整備": 0.70],
            "チーム": ["会議": 0.70],
        ],
        "テスト": [
            "結果": ["報告": 0.80, "確認": 0.70],
            "ケース": ["作成": 0.80],
        ],
        "業務": [
            "改善": ["提案": 0.80, "活動": 0.70],
            "効率": ["化": 0.85, "向上": 0.75],
        ],
        "納期": [
            "遅延": ["対応": 0.80, "報告": 0.70],
        ],
        "セキュリティ": [
            "対策": ["強化": 0.80, "実施": 0.70],
        ],
        "前年": [
            "比": ["増加": 0.70, "減少": 0.65],
            "同期": ["比": 0.80],
        ],
        "顧客": [
            "対応": ["改善": 0.75, "強化": 0.65],
            "満足": ["度": 0.90],
        ],
    ]
}
